stages:
  - build-jar
  - test-integration
  - test-result

generate-jar:
  stage: build-jar
  image: maven:3.9.5-eclipse-temurin-17-alpine
  script: 
    - mvn clean install
  artifacts:
    paths:
      - target/api-0.0.1.jar
      
test-integration:
  stage: test-integration
  image: docker:24.0.5
  services:
    - docker:24.0.5-dind
  dependencies:
    - generate-jar    
  script:
    - docker build -t traffic-api --build-arg JAR_FILE=api-0.0.1.jar .
    - chmod +x wait-for-it.sh
    - docker compose up -d      
  artifacts:
    paths:
      - mochawesome-report/

test-result:
  stage: test-result
  image: node:18.16.0
  dependencies:
    - test-integration  
  script:
    - ls -la mochawesome-report    
  artifacts:
    paths:
      - mochawesome-report/